---
import BasicLayout from '../layout/Basiclayout.astro';
import Card from '../layout/Card.astro';

const responseData = await fetch('https://randomuser.me/api/?results=11');
const users = await responseData.json();
---

<BasicLayout title="Home">
    <a href="https://Alexouuuuuuuuuuu.github.io/projet2/" class="text-3xl font-bold hover:text-blue-600 underline">
        <h1>
            Alexisite
        </h1>
    </a>

        <h2 class="text-5xl text-shadow-red-600 font-bold font-minecraft mt-8 ">Personnage</h2>
        <div class="w-full select-none max-w-full overflow-x-auto whitespace-nowrap py-4" style="cursor: grab;" id="infinite-scroll-container">
            <ul class="flex flex-row gap-6 mt-8 selection-none" id="users-list">
                {users.results.map((user: any) => (
                    <li class="inline-block ">
                        <Card user={user} />
                    </li>
                ))}
            </ul>
        </div>
        <div class="w-full select-none max-w-full overflow-x-auto whitespace-nowrap py-4" style="cursor: grab;" id="infinite-scroll-container-2">
            <ul class="flex flex-row gap-6 mt-8 selection-none" id="users-list-2">
            {users.results.map((user: any) => (
                <li class="inline-block ">
                <Card user={user} />
                </li>
            ))}
            </ul>
        </div>
        <style>
            #infinite-scroll-container,
            #infinite-scroll-container-2 {
                scrollbar-width: none; 
                -ms-overflow-style: none;
            }

        </style>
        <script type="module">
            const container1 = document.getElementById('infinite-scroll-container');
            const ul1 = document.getElementById('users-list');
            let usersData1 = [...ul1.children];

            const container2 = document.getElementById('infinite-scroll-container-2');
            const ul2 = document.getElementById('users-list-2');
            let usersData2 = [...ul2.children];

            container1.addEventListener('scroll', function() {
            if (container1.scrollLeft + container1.clientWidth >= container1.scrollWidth - 10) {
                usersData1.forEach(node => {
                ul1.appendChild(node.cloneNode(true));
                });
            }
            });

            // Infinite scroll pour la deuxième ligne
            container2.addEventListener('scroll', function() {
            if (container2.scrollLeft <= 10) {
                // Ajoute à gauche
                usersData2.slice().reverse().forEach(node => {
                ul2.insertBefore(node.cloneNode(true), ul2.firstChild);
                // Décale le scroll pour ne pas "sauter"
                container2.scrollLeft += node.offsetWidth + 24; // 24 = gap-6
                });
            }
            });

            // Auto-scroll première ligne (droite)
            let autoScrollSpeed1 = 2;
            let autoScrollActive1 = true;
            function autoScroll1() {
            if (!autoScrollActive1) return;
            if (container1.scrollLeft + container1.clientWidth >= container1.scrollWidth - 10) {
                usersData1.forEach(node => {
                ul1.appendChild(node.cloneNode(true));
                });
            }
            container1.scrollLeft += autoScrollSpeed1;
            requestAnimationFrame(autoScroll1);
            }
            requestAnimationFrame(autoScroll1);

            // Auto-scroll deuxième ligne (gauche)
            let autoScrollSpeed2 = 2;
            let autoScrollActive2 = true;
            // Place le scroll tout à droite au départ
            container2.scrollLeft = container2.scrollWidth;
            function autoScroll2() {
            if (!autoScrollActive2) return;
            if (container2.scrollLeft <= 10) {
                usersData2.slice().reverse().forEach(node => {
                ul2.insertBefore(node.cloneNode(true), ul2.firstChild);
                container2.scrollLeft += node.offsetWidth + 24;
                });
            }
            container2.scrollLeft -= autoScrollSpeed2;
            requestAnimationFrame(autoScroll2);
            }
            requestAnimationFrame(autoScroll2);
        </script>

        <style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
.font-minecraft {
    font-family: 'Press Start 2P', monospace;
    font-size: 50px;
    letter-spacing: 1px;
}
.shadow-pixel {
    box-shadow: 4px 4px 0 0 #222;
}
.pixel-avatar {
    image-rendering: pixelated;
}
.pixel-card {
    border-radius: 0;
}
</style>

</BasicLayout>

